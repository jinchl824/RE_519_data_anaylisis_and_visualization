# Step 1. Read data
nmdb <- read_csv("/Users/jinchenliu/Downloads/nmdb-outstanding-mortgage-statistics-states-quarterly.csv")
# Step 2. Filter latest quarter
latest_year <- max(nmdb$YEAR, na.rm = TRUE)
latest_quarter <- max(nmdb$QUARTER[nmdb$YEAR == latest_year], na.rm = TRUE)
nmdb_latest <- nmdb %>%
filter(YEAR == latest_year, QUARTER == latest_quarter, VALUE1 > 0)
# Step 3. Summary for WA vs US
wa_stats <- nmdb_latest %>%
filter(GEONAME == "Washington") %>%
summarise(
mean = mean(VALUE1, na.rm = TRUE),
median = median(VALUE1, na.rm = TRUE),
min = min(VALUE1, na.rm = TRUE),
p25 = quantile(VALUE1, 0.25, na.rm = TRUE),
p75 = quantile(VALUE1, 0.75, na.rm = TRUE),
max = max(VALUE1, na.rm = TRUE)
)
us_stats <- nmdb_latest %>%
filter(GEONAME != "Washington") %>%
summarise(
mean = mean(VALUE1, na.rm = TRUE),
median = median(VALUE1, na.rm = TRUE),
min = min(VALUE1, na.rm = TRUE),
p25 = quantile(VALUE1, 0.25, na.rm = TRUE),
p75 = quantile(VALUE1, 0.75, na.rm = TRUE),
max = max(VALUE1, na.rm = TRUE)
)
wa_stats
us_stats
# Step 4. Pivot wider (compare dimensions)
dim(nmdb_latest)
nmdb_wide <- nmdb_latest %>%
pivot_wider(names_from = SERIESID, values_from = VALUE1)
dim(nmdb_wide)
# Step 5. Visualizations
# Filter out outliers for better view (remove extreme 1%)
nmdb_filtered <- nmdb_latest %>%
filter(VALUE1 > quantile(VALUE1, 0.01, na.rm = TRUE),
VALUE1 < quantile(VALUE1, 0.99, na.rm = TRUE))
# ① Histogram
ggplot(nmdb_filtered, aes(x = VALUE1)) +
geom_histogram(bins = 40, fill = "#5DADE2", color = "white", alpha = 0.9) +
labs(
title = "Distribution of Outstanding Mortgage Values (filtered 1%-99%)",
x = "Outstanding Mortgage Value",
y = "Count"
) +
theme_minimal(base_size = 13)
# ② Boxplot
ggplot(nmdb_filtered, aes(x = MARKET, y = VALUE1)) +
geom_boxplot(fill = "#AED6F1", color = "gray30", outlier.size = 0.5) +
labs(
title = "Mortgage Values by Market (Filtered Range)",
y = "Outstanding Mortgage Value"
) +
theme_minimal(base_size = 13) +
theme(axis.text.x = element_text(angle = 20, hjust = 1))
# ③ CDF (use log10 for smooth shape)
ggplot(
nmdb_latest %>% filter(GEONAME %in% c("Washington", "California", "Texas")),
aes(x = VALUE1, color = GEONAME)
) +
stat_ecdf(size = 0.8) +
scale_x_log10(limits = c(1, 10000)) +
labs(
title = "CDF of Outstanding Mortgage Values by State (log scale)",
x = "Outstanding Mortgage Value (log10)",
y = "Cumulative Probability"
) +
theme_minimal(base_size = 13) +
theme(legend.position = "bottom", legend.title = element_blank())
# ④ Scatter plot
ggplot(nmdb_filtered, aes(x = reorder(GEONAME, VALUE1, median), y = VALUE1)) +
geom_jitter(alpha = 0.4, color = "#2E86C1", size = 0.8, width = 0.3) +
labs(
title = "Mortgage Value Distribution by State (Filtered Range)",
x = "State",
y = "Outstanding Mortgage Value"
) +
theme_minimal(base_size = 13) +
theme(axis.text.x = element_text(angle = 60, hjust = 1))
# Step 6. Summary
cat("\nSummary:\nThe filtered histogram and boxplots show clearer right-skewed patterns without extreme outliers.",
"Washington and California show higher mortgage values overall, while Texas distribution is more compact.\n")
library(tidyverse)
# 1. 读取数据
nmdb <- read_csv("/Users/jinchenliu/Downloads/nmdb-outstanding-mortgage-statistics-states-quarterly.csv")
# 2. 查看行列数
dim(nmdb)
# 3. 筛选最新季度数据
latest_year <- max(nmdb$YEAR, na.rm = TRUE)
latest_quarter <- max(nmdb$QUARTER[nmdb$YEAR == latest_year], na.rm = TRUE)
nmdb_latest <- nmdb %>%
filter(YEAR == latest_year, QUARTER == latest_quarter)
# 4. Washington 和 其他州数据统计
wa_stats <- nmdb_latest %>%
filter(GEONAME == "Washington") %>%
summarise(
mean = mean(VALUE1, na.rm = TRUE),
median = median(VALUE1, na.rm = TRUE),
min = min(VALUE1, na.rm = TRUE),
p25 = quantile(VALUE1, 0.25, na.rm = TRUE),
p75 = quantile(VALUE1, 0.75, na.rm = TRUE),
max = max(VALUE1, na.rm = TRUE)
)
us_stats <- nmdb_latest %>%
filter(GEONAME != "Washington") %>%
summarise(
mean = mean(VALUE1, na.rm = TRUE),
median = median(VALUE1, na.rm = TRUE),
min = min(VALUE1, na.rm = TRUE),
p25 = quantile(VALUE1, 0.25, na.rm = TRUE),
p75 = quantile(VALUE1, 0.75, na.rm = TRUE),
max = max(VALUE1, na.rm = TRUE)
)
wa_stats
us_stats
# 5. 数据宽表转换并比较行列数
dim(nmdb_latest)
nmdb_wide <- nmdb_latest %>%
pivot_wider(names_from = SERIESID, values_from = VALUE1)
dim(nmdb_wide)
# 6. 可视化（课堂标准方法）
# Histogram
ggplot(nmdb_latest, aes(x = VALUE1)) +
geom_histogram(bins = 40, fill = "skyblue", color = "white") +
labs(
title = "Histogram of Outstanding Mortgage Values",
x = "Outstanding Mortgage Value",
y = "Count"
) +
theme_minimal(base_size = 13)
# Boxplot
ggplot(nmdb_latest, aes(x = MARKET, y = VALUE1)) +
geom_boxplot(fill = "lightgray", outlier.color = "red") +
labs(
title = "Boxplot of Mortgage Values by Market",
y = "Outstanding Mortgage Value"
) +
theme_minimal(base_size = 13)
# CDF 图 (Washington, California, Texas)
ggplot(
nmdb_latest %>% filter(GEONAME %in% c("Washington", "California", "Texas"), VALUE1 > 0),
aes(x = VALUE1, color = GEONAME)
) +
stat_ecdf(size = 0.8) +
scale_x_log10() +
labs(
title = "CDF of Outstanding Mortgage Values by State (log scale)",
x = "Outstanding Mortgage Value (log10)",
y = "Cumulative Probability"
) +
theme_minimal(base_size = 13) +
theme(legend.position = "bottom", legend.title = element_blank())
# 7. 简短结论
cat("\nSummary:\nWashington state has slightly higher average outstanding mortgage values compared to the rest of the US.",
"The histogram shows a right-skewed distribution.",
"Boxplots highlight clear variation among different markets, and the CDF chart shows Washington's loans tend to cluster at higher value levels.\n")
library(tidyverse)
nmdb <- read_csv("/Users/jinchenliu/Downloads/nmdb-outstanding-mortgage-statistics-states-quarterly.csv")
dim(nmdb)
latest_year <- max(nmdb$YEAR, na.rm = TRUE)
latest_quarter <- max(nmdb$QUARTER[nmdb$YEAR == latest_year], na.rm = TRUE)
nmdb_latest <- nmdb %>%
filter(YEAR == latest_year, QUARTER == latest_quarter)
wa_stats <- nmdb_latest %>%
filter(GEONAME == "Washington") %>%
summarise(
mean = mean(VALUE1, na.rm = TRUE),
median = median(VALUE1, na.rm = TRUE),
min = min(VALUE1, na.rm = TRUE),
p25 = quantile(VALUE1, 0.25, na.rm = TRUE),
p75 = quantile(VALUE1, 0.75, na.rm = TRUE),
max = max(VALUE1, na.rm = TRUE)
)
us_stats <- nmdb_latest %>%
filter(GEONAME != "Washington") %>%
summarise(
mean = mean(VALUE1, na.rm = TRUE),
median = median(VALUE1, na.rm = TRUE),
min = min(VALUE1, na.rm = TRUE),
p25 = quantile(VALUE1, 0.25, na.rm = TRUE),
p75 = quantile(VALUE1, 0.75, na.rm = TRUE),
max = max(VALUE1, na.rm = TRUE)
)
wa_stats
us_stats
dim(nmdb_latest)
nmdb_wide <- nmdb_latest %>%
pivot_wider(names_from = SERIESID, values_from = VALUE1)
dim(nmdb_wide)
# Histogram
ggplot(nmdb_latest %>% filter(VALUE1 > 0, VALUE1 < quantile(VALUE1, 0.99, na.rm = TRUE)),
aes(x = VALUE1)) +
geom_histogram(bins = 40, fill = "#5DADE2", color = "white", alpha = 0.9) +
scale_x_log10() +
labs(
title = "Histogram of Outstanding Mortgage Values (log scale, trimmed top 1%)",
x = "Outstanding Mortgage Value (log10)",
y = "Count"
) +
theme_minimal(base_size = 13)
# Boxplot
ggplot(nmdb_latest, aes(x = MARKET, y = VALUE1)) +
geom_boxplot(fill = "lightgray", outlier.color = "red") +
labs(
title = "Boxplot of Mortgage Values by Market",
y = "Outstanding Mortgage Value"
) +
theme_minimal(base_size = 13)
# CDF (Washington, California, Texas)
ggplot(
nmdb_latest %>% filter(GEONAME %in% c("Washington", "California", "Texas"), VALUE1 > 0),
aes(x = VALUE1, color = GEONAME)
) +
stat_ecdf(size = 0.8) +
scale_x_log10() +
labs(
title = "CDF of Outstanding Mortgage Values by State (log scale)",
x = "Outstanding Mortgage Value (log10)",
y = "Cumulative Probability"
) +
theme_minimal(base_size = 13) +
theme(legend.position = "bottom", legend.title = element_blank())
cat("\nSummary:\nWashington state has slightly higher average outstanding mortgage values compared to the rest of the US.",
"The histogram shows a right-skewed distribution.",
"Boxplots highlight clear variation among different markets, and the CDF chart shows Washington's loans tend to cluster at higher value levels.\n")
knitr::opts_chunk$set(echo = TRUE)
library('tidyverse')
library('ggplot2') # the major package for visualization in R
hvi <- read_csv("zillow_hvi_msa.csv")
hvi <- read_csv("zillow_hvi_msa.csv",
col_types = cols(
RegionName = col_character(),
StateName  = col_character(),
Region   = col_character(), # Census Bureau Regions
RegionID   = col_double(),
Popu2024   = col_number(),
.default   = col_double()   # for other columns
)
)
head(hvi, 3)
head(hvi, 3)
hvi_tidy <- hvi %>%
pivot_longer( # using `pivot_longer` to reshape wide → long
cols = -c("RegionID", "RegionName", "Popu2024", "StateName", "Region"), # keep these 4 as identifier variables (don’t pivot them)
names_to = "Date",  # old column names (like "1/31/00") become a new column called Date
values_to = "HVI" # the cell values go into a new column called HVI
# values_drop_na = TRUE; default as FALSE; if TRUE, will remove rows with missing HVI.
) %>%
mutate(
Date = as.Date(Date, format = "%m/%d/%y")
)
head(hvi_tidy,3)
hvi_wide <- hvi_tidy %>%
pivot_wider(
names_from = Date,   # expand `Date` to multiple rows
values_from = HVI    # extract`HVI` column to those new columns
)
head(hvi_wide, 3)
colSums(is.na(hvi_tidy))
# remove NA then we can see there are 9237 rows afterwards, 3 missing values are removed
hvi_tidy_NA_remove <- hvi_tidy %>%
filter(!is.na(HVI))
dim(hvi_tidy_NA_remove)
# install.packages("zoo")
# install.packages("tidyverse")
library(tidyverse)
library(zoo)
hvi <- read_csv("zillow_hvi_msa.csv")
hvi_tidy <- hvi %>%
pivot_longer(
cols = -c("RegionID", "RegionName", "Popu2024", "StateName", "Region"),
names_to = "Date",
values_to = "HVI"
) %>%
mutate(Date = as.Date(Date, format = "%m/%d/%y") )
hvi_tidy <- hvi_tidy %>%
group_by(RegionName) %>%
arrange(Date) %>%
mutate(HVI = na.approx(HVI, x = Date, na.rm = FALSE)) %>%
ungroup()
colSums(is.na(hvi_tidy))
# install.packages("skimr") # you only need to install once
library(skimr)
skim(hvi_tidy) # run `skim()` to get a quick overview of the dataset
hvi_pnw <- hvi_tidy_NA_remove %>%
filter(RegionName %in% c("Seattle, WA", "Portland, OR"))
ggplot(hvi_pnw, aes(x = Date, y = HVI, group = RegionName)) # will show below the chunk
g <- ggplot(hvi_pnw, aes(x = Date, y = HVI, color = RegionName)) # will not show the plots
g <- g + geom_line(aes(color = RegionName),
alpha = 0.8, # Opacity: 0 means fully transparent (invisible)
linetype = 6, # 6 = twodash, you can check more option using `?linetype`
linewidth = 0.8) # linewidth
g
g <- g + scale_y_continuous(labels = scales::comma, # format numbers with commas
trans = "log10") # apply base-10 log transformation
g
g <- g + coord_cartesian(xlim = c(as.Date("2010-01-01"), as.Date("2020-6-30")),
ylim = c(NA, 600000)) # we did not define the low bound of y
g
g <- g + facet_wrap(~ RegionName)
g
g <- g +
labs(
x = "Year",                # label for x axis
y = "Home Value Index",    # label for y axis
title = "Seattle and Portland Housing Trend 2010–2020", # main title
subtitle = "Data source: Zillow HVI",      # subtitle
caption = "Visualization using R and ggplot2"     # caption
)
g
g <- g + theme_light(base_size = 12) + # use a minimal theme and the base size as 12
theme(panel.grid.minor = element_blank(), # remove minor grids
legend.position = "none"
)
g
ggsave(
filename = "Seattle and Portland HVI Trend.png",
plot = g,
width = 12,
height = 6,
dpi = 300
) # save the last plot as 12 * 5 inch png file with 300 dpi (dots per inch)
ggplot(data = hvi_tidy_NA_remove %>%
filter(Date == as.Date("2025-08-31")), aes(x = Popu2024)) +
geom_histogram(
bins = 10,        # number of bins
color = "white",  # border color
alpha = 0.7       # transparency
) +
labs(title = "Histograms of Metropolitan Statistical Area Population", x = "Population (2024)", y = "Count of Cities") +
theme_minimal()
ggplot(data = hvi_tidy %>%
filter(Date == as.Date("2025-08-31")), aes(x = Popu2024)) +
geom_dotplot(
binwidth = 500000,
fill = "black",
color = "white",
alpha = 0.7
) +
labs(title = "Dotplot of Metropolitan Statistical Area Population", x = "Population (2024)", y = NULL) +
theme_minimal()
ggplot(
data = hvi_tidy_NA_remove %>%
filter(Date == as.Date("2025-08-31")),
aes(y = Popu2024, x = Region)
) +
geom_boxplot(
fill = "black",
alpha = 0.3,       # transparency
width = 0.5        # box width
) +
labs(
title = "Boxplot of City Population by Census Bureau Regions",
y = "Population (2024)",
x = NULL
) +
theme_minimal()
ggplot(
data = hvi_tidy_NA_remove %>%
filter(Date == as.Date("2025-08-31")),
aes(y = Popu2024, x = Region)
) +
geom_boxplot(
fill = "black",
alpha = 0.3,
width = 0.5
) +
geom_jitter(
aes(color = Region),
alpha = 0.7,
width = 0.15,
height = 0
) +
labs(
title = "Boxplot of City Population by Census Bureau Regions",
y = "Population (2024)",
x = NULL
) +
theme_minimal()+
theme(legend.position = "none")
ggplot(data = hvi_tidy_NA_remove %>%
filter(
RegionName %in% c("Seattle, WA", "New York, NY", "San Francisco, CA")
)) +
stat_ecdf(# stat builds new variables to plot, we build CDF
aes(x = HVI, color = RegionName),) + # we use color to distinguish regions
labs(title = "CDF HVI for Seattle, New York and SF",
subtitle = "F(x) = P(X ≤ x)",
y = "Cumulative Distribution Function (CDF)",
x = "Home Value Index") +
theme_minimal() +
theme(legend.position = "bottom") # because we have `color`, ggplot will generate legend
ggplot(
data = hvi_tidy_NA_remove %>%
filter(Date == as.Date("2025-08-31")),
aes(x = Popu2024, y = HVI)
) +
geom_point(alpha = 0.6) +
geom_smooth( # we use a sample linear regression to model the relationship (trends)
method = "lm",
formula = y ~ x,
se = TRUE, # show confidence interval
color = "#4B2E83"
) +
labs(
title = "Scatterplots of City Population and Home Value Index",
x = "Population (2024)",
y = "Home Value Index"
) +
theme_minimal()
ggplot(data = hvi_tidy_NA_remove %>%
filter(Date == as.Date("2025-08-31"))) +
geom_point(aes(x = StateName, y = HVI, size = Popu2024 ), alpha = 0.6) + # bubble size = population
scale_y_continuous(labels = scales::comma) +
scale_size_continuous(range = c(1, 10), labels = scales::comma) +
labs(
title = "Bubble Chart of Population and Home Value Index by State",
x = "State",
y = "Home Value Index",
size = "Population (2024)"
) +
theme_minimal() +
theme(
legend.position = "bottom",
axis.text.x = element_text(angle = 45, hjust = 1) # rotate state labels
)
ggplot(
data = hvi_tidy_NA_remove
) +
geom_tile(aes(x = Date, y = RegionName, fill = HVI)) +
scale_fill_viridis_c(option = "magma", direction = -1) +
labs(
title = "Home Value Index Over Time by City",
x = "Year",
y = "City"
) +
scale_x_date(date_breaks = "5 year", date_labels = "%Y") +
theme_minimal() +
theme(panel.grid = element_blank())
# yes
library(tidyverse)
nmdb <- read_csv("/Users/jinchenliu/Downloads/nmdb-outstanding-mortgage-statistics-states-quarterly.csv")
dim(nmdb)
latest_year <- max(nmdb$YEAR, na.rm = TRUE)
latest_quarter <- max(nmdb$QUARTER[nmdb$YEAR == latest_year], na.rm = TRUE)
nmdb_latest <- nmdb %>%
filter(YEAR == latest_year, QUARTER == latest_quarter)
wa_stats <- nmdb_latest %>%
filter(GEONAME == "Washington") %>%
summarise(
mean = mean(VALUE1, na.rm = TRUE),
median = median(VALUE1, na.rm = TRUE),
min = min(VALUE1, na.rm = TRUE),
p25 = quantile(VALUE1, 0.25, na.rm = TRUE),
p75 = quantile(VALUE1, 0.75, na.rm = TRUE),
max = max(VALUE1, na.rm = TRUE)
)
us_stats <- nmdb_latest %>%
filter(GEONAME != "Washington") %>%
summarise(
mean = mean(VALUE1, na.rm = TRUE),
median = median(VALUE1, na.rm = TRUE),
min = min(VALUE1, na.rm = TRUE),
p25 = quantile(VALUE1, 0.25, na.rm = TRUE),
p75 = quantile(VALUE1, 0.75, na.rm = TRUE),
max = max(VALUE1, na.rm = TRUE)
)
wa_stats
us_stats
dim(nmdb_latest)
nmdb_wide <- nmdb_latest %>%
pivot_wider(names_from = SERIESID, values_from = VALUE1)
dim(nmdb_wide)
# Histogram
ggplot(nmdb_latest %>% filter(VALUE1 > 0, VALUE1 < quantile(VALUE1, 0.99, na.rm = TRUE)),
aes(x = VALUE1)) +
geom_histogram(bins = 40, fill = "#5DADE2", color = "white", alpha = 0.9) +
scale_x_log10() +
labs(
title = "Histogram of Outstanding Mortgage Values (log scale, trimmed top 1%)",
x = "Outstanding Mortgage Value (log10)",
y = "Count"
) +
theme_minimal(base_size = 13)
# Boxplot
ggplot(nmdb_latest, aes(x = MARKET, y = VALUE1)) +
geom_boxplot(fill = "lightgray", outlier.color = "red") +
labs(
title = "Boxplot of Mortgage Values by Market",
y = "Outstanding Mortgage Value"
) +
theme_minimal(base_size = 13)
# CDF (Washington, California, Texas)
ggplot(
nmdb_latest %>% filter(GEONAME %in% c("Washington", "California", "Texas"), VALUE1 > 0),
aes(x = VALUE1, color = GEONAME)
) +
stat_ecdf(size = 0.8) +
scale_x_log10() +
labs(
title = "CDF of Outstanding Mortgage Values by State (log scale)",
x = "Outstanding Mortgage Value (log10)",
y = "Cumulative Probability"
) +
theme_minimal(base_size = 13) +
theme(legend.position = "bottom", legend.title = element_blank())
cat("\nSummary:\nWashington state has slightly higher average outstanding mortgage values compared to the rest of the US.",
"The histogram shows a right-skewed distribution.",
"Boxplots highlight clear variation among different markets, and the CDF chart shows Washington's loans tend to cluster at higher value levels.\n")
